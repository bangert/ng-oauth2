"use strict";angular.module("ng-oauth2").config(["$httpProvider",function(e){e.interceptors.push("oauthHttpInterceptor"),e.interceptors.push("oauthUnauthorizedHttpInterceptor")}]),angular.module("ng-oauth2.endpoint",[]).factory("OauthEndpoint",["$window","$location","Oauth",function(e,t,n){return{getOauthUrl:function(){var e,o=-1==n.authorizePath.indexOf("?")?!1:!0,r=o?"&":"?";return e=n.oauthServerAddress+n.authorizePath+r+"response_type="+n.responseType+"&client_id="+encodeURIComponent(n.clientId)+"&redirect_uri="+encodeURIComponent(t.absUrl())+"&scope="+n.scope+"&state="+n.state},redirectToOauthPage:function(){e.location.assign(this.getOauthUrl())},redirectToUnauthorizedPage:function(){e.location.assign(n.unauthorizedUrl)}}}]),angular.module("ng-oauth2").factory("oauthHttpInterceptor",["$q","Oauth","OauthToken",function(e,t,n){return{request:function(e){return t.sendTokenOnEveryRequest&&n.getToken()&&(e.headers[t.headerTokenName]=n.getToken().access_token),e}}}]),angular.module("ng-oauth2.profile",[]).factory("OauthProfile",["$http","Oauth",function(e,t){var n=null;return{makeProfileRequest:function(){e.get(t.profileUrl).success(function(e){n=e})},getProfile:function(){return n},hasProfile:function(){return!!n}}}]),angular.module("ng-oauth2",["ng-oauth2.token","ng-oauth2.profile","ng-oauth2.endpoint"]).provider("Oauth",function(){var e={oauthServerAddress:"",clientId:"",profileUrl:"",authorizePath:"/oauth/authorize",unauthorizedUrl:"",responseType:"token",scope:"",state:"",headerTokenName:"Authorization",randomizeState:!0,redirectOnUnauthorized:!0,sendTokenOnEveryRequest:!0};return{setOauthServerAddress:function(t){e.oauthServerAddress=t},setClientId:function(t){e.clientId=t},setProfileUrl:function(t){e.profileUrl=t},setAuthorizePath:function(t){e.authorizePath=t},setUnauthorizedUrl:function(t){e.unauthorizedUrl=t},setResponseType:function(t){e.responseType=t},setScope:function(t){e.scope=t},setState:function(t){e.state=t},setHeaderTokenName:function(t){e.headerTokenName=t},setRandomizeState:function(t){e.randomizeState=t},setRedirectOnUnauthorized:function(t){e.redirectOnUnauthorized=t},setSendTokenOnEveryRequest:function(t){e.sendTokenOnEveryRequest=t},$get:function(){return e}}}),angular.module("ng-oauth2").run(["OauthToken","OauthProfile","OauthEndpoint",function(e,t,n){var o=e.getTokenFromString();o&&e.setToken(o),e.isTokenSet()&&!e.isExpired()&&t.makeProfileRequest(),e.isTokenSet()||n.redirectToOauthPage()}]),angular.module("ng-oauth2.token",["ngStorage"]).factory("OauthToken",["$rootScope","$location","$sessionStorage",function(e,t,n){return{setToken:function(e){n.oauthToken=e},getToken:function(){return n.oauthToken},isTokenSet:function(){return this.getToken()?!0:!1},getTokenFromString:function(){for(var e,n={},o=/([^&=]+)=([^&]*)/g;e=o.exec(t.hash());)n[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return n.access_token||n.error?n:void 0},isExpired:function(){return this.getToken()&&this.getToken().expires_at&&new Date(this.getToken().expires_at)<new Date},destroy:function(){n.oauthToken=null,e.$broadcast("oauth:logout")}}}]),angular.module("ng-oauth2").factory("oauthUnauthorizedHttpInterceptor",["$rootScope","$q","Oauth","OauthEndpoint",function(e,t,n,o){return{responseError:function(e){return n.redirectOnUnauthorized&&401===e.status&&o.redirectToUnauthorizedPage(),t.reject(e)}}}]);